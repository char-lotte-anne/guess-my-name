# GitHub Issues API Setup - Automated Data Collection

## ‚úÖ Implementation Complete!

The automated data collection via GitHub Issues API has been fully implemented using a Vercel serverless function. Here's what was added:

## What Was Implemented

### 1. Frontend Data Submission (`src/script.js`)
- Added `sendTrainingDataToGitHub()` method
- Automatically sends training data to GitHub Issues when users provide feedback or enter their name
- Uses Vercel serverless function (`/api/create-issue`) to authenticate with GitHub
- Fails gracefully if serverless function is unavailable (doesn't break user experience)

### 2. Serverless Function (`api/create-issue.js`)
- Vercel serverless function that authenticates with GitHub
- Creates GitHub Issues with training data
- Handles errors gracefully
- See [VERCEL_SETUP.md](VERCEL_SETUP.md) for setup instructions

### 2. Data Collection Script (`scripts/collect-training-data.js`)
- Fetches training data from GitHub Issues
- Parses JSON from issue bodies
- Closes processed issues automatically
- Merges with existing training data from file

### 3. GitHub Actions Workflow (`.github/workflows/train-model.yml`)
- Updated to pass GitHub token and repository info to collection script
- Automatically processes issues during training runs

## How It Works

### User Flow:
1. User completes quiz and provides feedback (correct/wrong)
2. Frontend stores data locally (existing behavior)
3. Frontend **also** sends anonymized data to GitHub Issues API
4. GitHub Issue is created with label `training-data`

### Training Flow:
1. GitHub Actions runs weekly (or manually)
2. Collection script fetches all open issues with `training-data` label
3. Parses training data from issue bodies
4. Closes processed issues
5. Trains model on aggregated data
6. Creates release with trained model

## Setup Required

### Step 1: Create GitHub Labels

You need to create two labels in your GitHub repository:

1. **`training-data` label:**
   - Go to your repo ‚Üí Issues ‚Üí Labels ‚Üí New label
   - Name: `training-data`
   - Color: `#0E8A16` (green) or any color you prefer
   - Description: "Training data for ML model"
   - Click "Create label"

2. **`auto-generated` label (optional but recommended):**
   - Name: `auto-generated`
   - Color: `#D4C5F9` (purple) or any color
   - Description: "Automatically generated by the application"
   - Click "Create label"

### Step 2: Set Up Vercel Serverless Function

**IMPORTANT**: You must set up the Vercel serverless function before this will work!

See [VERCEL_SETUP.md](VERCEL_SETUP.md) for complete setup instructions.

Quick summary:
1. Create a GitHub Personal Access Token (with `repo` scope)
2. Deploy to Vercel (free)
3. Add `GITHUB_TOKEN` environment variable in Vercel
4. Deploy and test

### Step 3: Verify Repo Settings

- Make sure Issues are enabled in your repo (Settings ‚Üí General ‚Üí Features)
- For public repos, this is enabled by default

### Step 4: Test It!

1. **Test data submission:**
   - Complete a quiz on your site
   - Click "correct" or "wrong"
   - Check your GitHub repo's Issues tab
   - You should see a new issue with `training-data` label

2. **Test data collection:**
   - Go to GitHub Actions tab
   - Run "Train Global Model" workflow manually
   - Check logs - should see "üì• Collecting training data from GitHub Issues..."
   - Issues should be closed after processing

## Privacy & Security

### What Gets Sent:
- ‚úÖ Quiz answers (anonymized)
- ‚úÖ Success/failure status
- ‚úÖ Correct guess (if successful) or guesses (if failed)
- ‚úÖ Timestamp

### What Does NOT Get Sent:
- ‚ùå Real name (explicitly excluded)
- ‚ùå Email addresses
- ‚ùå Any identifying information
- ‚ùå IP addresses

### Data Storage:
- Data is stored in GitHub Issues (publicly visible in your repo)
- Issues are automatically closed after processing
- You can delete issues if needed
- All data is anonymized before sending

## Troubleshooting

### Issues Not Being Created
- **Check browser console for errors** - Look for detailed error messages
- **Verify Vercel serverless function is deployed** - See [VERCEL_SETUP.md](VERCEL_SETUP.md)
- **Check Vercel function logs** - Go to Vercel Dashboard ‚Üí Functions ‚Üí api/create-issue
- **Verify GITHUB_TOKEN is set** - Check Vercel environment variables
- **Make sure Issues are enabled** - Check repo settings
- **Verify API endpoint** - Should be `/api/create-issue` (relative) or your Vercel URL

### Issues Not Being Collected
- Verify labels exist (`training-data` label is required)
- Check GitHub Actions logs for errors
- Verify GITHUB_TOKEN is available (automatically provided)
- Check that issues have valid JSON in code blocks

### Issues Not Being Closed
- Requires GITHUB_TOKEN (automatically provided by GitHub Actions)
- Check GitHub Actions logs
- Verify token has write permissions (should be automatic)

## Code Locations

- **Frontend submission:** `src/script.js` ‚Üí `sendTrainingDataToGitHub()` method
- **Serverless function:** `api/create-issue.js` ‚Üí Vercel serverless function
- **Data collection:** `scripts/collect-training-data.js` ‚Üí `collectFromGitHubIssues()` function
- **Workflow:** `.github/workflows/train-model.yml` ‚Üí Collect training data step

## Benefits

‚úÖ **Fully Automated** - No manual data collection needed  
‚úÖ **Real-time** - Data collected as users provide feedback  
‚úÖ **Privacy-preserving** - Only anonymized data sent  
‚úÖ **Free** - Uses GitHub's free API  
‚úÖ **Scalable** - Handles any number of issues  
‚úÖ **Self-cleaning** - Issues automatically closed after processing  

## Next Steps

1. **Set up Vercel serverless function** - See [VERCEL_SETUP.md](VERCEL_SETUP.md) (REQUIRED)
2. Create the labels (see Step 1 above)
3. Test with a few quiz completions
4. Verify issues are created in GitHub
5. Run workflow manually to test collection
6. Set it and forget it! üéâ

The system is now fully automated - users provide feedback, data flows to GitHub Issues, and the model trains automatically every week!
